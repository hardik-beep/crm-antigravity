{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Hardik/Downloads/crm/lib/db.ts"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\n\r\nconst DB_PATH = path.join(process.cwd(), 'data');\r\nconst DB_FILE = path.join(DB_PATH, 'db.json');\r\n\r\n// Ensure data directory exists\r\nif (!fs.existsSync(DB_PATH)) {\r\n    fs.mkdirSync(DB_PATH, { recursive: true });\r\n}\r\n\r\nexport interface DBUser {\r\n    id: string;\r\n    username: string; // ID/Email\r\n    password: string;\r\n    name: string;\r\n    role: 'admin' | 'agent';\r\n    createdAt: string;\r\n}\r\n\r\nexport interface DBSession {\r\n    sessionId: string;\r\n    userId: string;\r\n    punchInTime: string;\r\n    lastActiveTime: string;\r\n    isActive: boolean;\r\n}\r\n\r\ninterface DBData {\r\n    users: DBUser[];\r\n    sessions: DBSession[];\r\n}\r\n\r\nconst INITIAL_DATA: DBData = {\r\n    users: [\r\n        {\r\n            id: 'admin-1',\r\n            username: 'admin',\r\n            password: 'admin123', // Default credentials\r\n            name: 'Administrator',\r\n            role: 'admin',\r\n            createdAt: new Date().toISOString(),\r\n        }\r\n    ],\r\n    sessions: []\r\n};\r\n\r\nfunction readDB(): DBData {\r\n    if (!fs.existsSync(DB_FILE)) {\r\n        fs.writeFileSync(DB_FILE, JSON.stringify(INITIAL_DATA, null, 2));\r\n        return INITIAL_DATA;\r\n    }\r\n    try {\r\n        const data = fs.readFileSync(DB_FILE, 'utf-8');\r\n        return JSON.parse(data);\r\n    } catch (error) {\r\n        return INITIAL_DATA;\r\n    }\r\n}\r\n\r\nfunction writeDB(data: DBData) {\r\n    fs.writeFileSync(DB_FILE, JSON.stringify(data, null, 2));\r\n}\r\n\r\nexport const db = {\r\n    getUsers: () => readDB().users,\r\n    addUser: (user: DBUser) => {\r\n        const data = readDB();\r\n        data.users.push(user);\r\n        writeDB(data);\r\n    },\r\n    deleteUser: (userId: string) => {\r\n        const data = readDB();\r\n        data.users = data.users.filter(u => u.id !== userId);\r\n        // Also remove sessions\r\n        data.sessions = data.sessions.filter(s => s.userId !== userId);\r\n        writeDB(data);\r\n    },\r\n    findUser: (username: string) => readDB().users.find(u => u.username === username),\r\n\r\n    getSessions: () => readDB().sessions,\r\n    createSession: (session: DBSession) => {\r\n        const data = readDB();\r\n        // Deactivate previous sessions for this user?? Maybe allow multiple?\r\n        // Let's close previous active sessions for this user to be clean\r\n        data.sessions.forEach(s => {\r\n            if (s.userId === session.userId && s.isActive) {\r\n                s.isActive = false;\r\n                // s.punchOutTime if we tracked it\r\n            }\r\n        });\r\n        data.sessions.push(session);\r\n        writeDB(data);\r\n    },\r\n    updateHeartbeat: (userId: string) => {\r\n        const data = readDB();\r\n        const session = data.sessions.find(s => s.userId === userId && s.isActive);\r\n        if (session) {\r\n            session.lastActiveTime = new Date().toISOString();\r\n            writeDB(data);\r\n        }\r\n    },\r\n    logoutUser: (userId: string) => {\r\n        const data = readDB();\r\n        const session = data.sessions.find(s => s.userId === userId && s.isActive);\r\n        if (session) {\r\n            session.isActive = false;\r\n            writeDB(data);\r\n        }\r\n    },\r\n    // Get active sessions populated with user details\r\n    getActiveAgents: () => {\r\n        const data = readDB();\r\n        return data.users.map(user => {\r\n            const activeSession = data.sessions.find(s => s.userId === user.id && s.isActive);\r\n            return {\r\n                ...user,\r\n                // Don't return password\r\n                password: '***',\r\n                isLoggedIn: !!activeSession,\r\n                punchInTime: activeSession?.punchInTime || null,\r\n                lastActiveTime: activeSession?.lastActiveTime || null,\r\n            };\r\n        });\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;AACzC,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,SAAS;AAEnC,+BAA+B;AAC/B,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,UAAU;IACzB,wGAAE,CAAC,SAAS,CAAC,SAAS;QAAE,WAAW;IAAK;AAC5C;AAwBA,MAAM,eAAuB;IACzB,OAAO;QACH;YACI,IAAI;YACJ,UAAU;YACV,UAAU;YACV,MAAM;YACN,MAAM;YACN,WAAW,IAAI,OAAO,WAAW;QACrC;KACH;IACD,UAAU,EAAE;AAChB;AAEA,SAAS;IACL,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,UAAU;QACzB,wGAAE,CAAC,aAAa,CAAC,SAAS,KAAK,SAAS,CAAC,cAAc,MAAM;QAC7D,OAAO;IACX;IACA,IAAI;QACA,MAAM,OAAO,wGAAE,CAAC,YAAY,CAAC,SAAS;QACtC,OAAO,KAAK,KAAK,CAAC;IACtB,EAAE,OAAO,OAAO;QACZ,OAAO;IACX;AACJ;AAEA,SAAS,QAAQ,IAAY;IACzB,wGAAE,CAAC,aAAa,CAAC,SAAS,KAAK,SAAS,CAAC,MAAM,MAAM;AACzD;AAEO,MAAM,KAAK;IACd,UAAU,IAAM,SAAS,KAAK;IAC9B,SAAS,CAAC;QACN,MAAM,OAAO;QACb,KAAK,KAAK,CAAC,IAAI,CAAC;QAChB,QAAQ;IACZ;IACA,YAAY,CAAC;QACT,MAAM,OAAO;QACb,KAAK,KAAK,GAAG,KAAK,KAAK,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,EAAE,KAAK;QAC7C,uBAAuB;QACvB,KAAK,QAAQ,GAAG,KAAK,QAAQ,CAAC,MAAM,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK;QACvD,QAAQ;IACZ;IACA,UAAU,CAAC,WAAqB,SAAS,KAAK,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,QAAQ,KAAK;IAExE,aAAa,IAAM,SAAS,QAAQ;IACpC,eAAe,CAAC;QACZ,MAAM,OAAO;QACb,qEAAqE;QACrE,iEAAiE;QACjE,KAAK,QAAQ,CAAC,OAAO,CAAC,CAAA;YAClB,IAAI,EAAE,MAAM,KAAK,QAAQ,MAAM,IAAI,EAAE,QAAQ,EAAE;gBAC3C,EAAE,QAAQ,GAAG;YACb,kCAAkC;YACtC;QACJ;QACA,KAAK,QAAQ,CAAC,IAAI,CAAC;QACnB,QAAQ;IACZ;IACA,iBAAiB,CAAC;QACd,MAAM,OAAO;QACb,MAAM,UAAU,KAAK,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UAAU,EAAE,QAAQ;QACzE,IAAI,SAAS;YACT,QAAQ,cAAc,GAAG,IAAI,OAAO,WAAW;YAC/C,QAAQ;QACZ;IACJ;IACA,YAAY,CAAC;QACT,MAAM,OAAO;QACb,MAAM,UAAU,KAAK,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,UAAU,EAAE,QAAQ;QACzE,IAAI,SAAS;YACT,QAAQ,QAAQ,GAAG;YACnB,QAAQ;QACZ;IACJ;IACA,kDAAkD;IAClD,iBAAiB;QACb,MAAM,OAAO;QACb,OAAO,KAAK,KAAK,CAAC,GAAG,CAAC,CAAA;YAClB,MAAM,gBAAgB,KAAK,QAAQ,CAAC,IAAI,CAAC,CAAA,IAAK,EAAE,MAAM,KAAK,KAAK,EAAE,IAAI,EAAE,QAAQ;YAChF,OAAO;gBACH,GAAG,IAAI;gBACP,wBAAwB;gBACxB,UAAU;gBACV,YAAY,CAAC,CAAC;gBACd,aAAa,eAAe,eAAe;gBAC3C,gBAAgB,eAAe,kBAAkB;YACrD;QACJ;IACJ;AACJ"}},
    {"offset": {"line": 167, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Hardik/Downloads/crm/app/api/admin/users/delete/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport { db } from '@/lib/db';\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const { userId } = await req.json();\r\n        if (!userId) {\r\n            return NextResponse.json({ error: 'Missing userId' }, { status: 400 });\r\n        }\r\n\r\n        db.deleteUser(userId);\r\n        return NextResponse.json({ success: true });\r\n    } catch (error) {\r\n        return NextResponse.json({ error: 'Failed to delete user' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEO,eAAe,KAAK,GAAY;IACnC,IAAI;QACA,MAAM,EAAE,MAAM,EAAE,GAAG,MAAM,IAAI,IAAI;QACjC,IAAI,CAAC,QAAQ;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAiB,GAAG;gBAAE,QAAQ;YAAI;QACxE;QAEA,iHAAE,CAAC,UAAU,CAAC;QACd,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAK;IAC7C,EAAE,OAAO,OAAO;QACZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ"}}]
}